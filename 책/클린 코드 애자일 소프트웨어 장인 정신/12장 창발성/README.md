# 12장 창발성

# 1. 창발적 설계로 깔끔한 코드를 구현하자

- 켄트백은 다음 규칙을 따르는 설계를 단순하다고 표현한다.(순서는 중요도 순)
    1. 모든 테스트를 실행한다.
    2. 중복을 없앤다.
    3. 프로그래머 의도를 표현한다.
    4. 클래스와 메서드 수를 최소로 줄인다.

<br />

# 2. 단순한 설계 규칙 1: 모든 테스트를 실행한다.

- 설계는 의도한 대로 동작해야 한다.
- 테스트를 거쳐 모든 테스트 케이스를 항상 통과하는 시스템은 **테스트가 가능한 시스템**이다.
- 테스트가 불가능하면 검증도 불가능하다.
- 논란의 여지가 있을 수 있지만 검증이 불가능하면 출시하면 안된다.
- 모든 테스트를 실행한다는 단순한 규칙을 지키려 할수록 시스템은 더 나아지고, 단일 책임 원칙(SRP)를 준수한 클래스가 테스트하기 더 수월하므로 더 나은 설계가 가능해진다.

<br />

# 3. 단순한 설계 규칙 2~4: 리팩터링

- 테스트케이스를 모두 작성했다면 코드와 클래스를 정리해도 괜찮다.
- 구체적으로는 코드를 점진적으로 리팩터링 해나간다.
- 새로 추가한 코드가 설계 품질을 낮춘다면 시스템이 깨질까 걱정하지 말고 정리한 후에 테스트를 통해 기존 기능을 깨뜨리지 않았다는 사실을 확인한다.
- 응집도를 높이고, 결합도를 낮추고, 관심사를 분리하고, 시스템 관심사를 모듈로 나누고, 함수와 클래스 크기를 줄이고, 더 나은 이름을 선택하는 등 무엇이든 적용해도 괜찮다.

<br />

# 4. 중복을 없애라

- 우수한 설계에서 중복은 추가 작업, 추가 위험, 불필요한 복잡도를 뜻하므로 없애야할 존재이다.
- 똑같은 코드, 구현 중복 등 다양한 형태의 중복을 줄여야 한다.

<br />

### 4-1) 메서드를 적절히 사용하여 중복 줄이기

```java
int size() {}
boolean isEmpty() {}
```

- size와 isEmpty는 구현 중복에 해당한다. 여기서 isEmpty 메서드를 호출했을 때 size와 비교하는 값을 리턴하게 되면 중복되는 코드를 줄일 수 있다.

<br />

```java
boolean isEmpty() {
	return 0 == size();
}
```

<br />

### 4-2) 메서드를 새로 생성하여 중복 줄이기

```java
public void scaleToOneDimension(...) {
	...
	image.dispose();
	System.gc();
	image = newImage;
}

public synchronized void rotate(...) {
	...
	image.dispose();
	System.gc();
	image = newImage;
}
```

- 위 코드에서는 완전히 중복되는 코드가 존재한다. 이를 새로운 메서드로 생성하여 그 메서드를 호출하는 방식으로 리팩터링한다면 중복을 줄일 수 있다.

<br />

```java
public void scaleToOneDimension(...) {
	...
	replaceImage(...);
}

public synchronized void rotate(...) {
	...
	replaceImage(...);
}

private void replaceImage(...) {
	image.dispose();
	System.gc();
	image = newImage;
}
```

- 아주 적은 양이라도 중복을 피할 수 있게 되지만, 경우에 따라 단일 책임 원칙(SRP)을 위반하게 되는 경우가 있는데 이럴 때는 해당 메서드를 다른 클래스로 옮겨도 좋다.

<br />

# 5. 표현하라.

- 자신이 이해하는 코드를 짜기는 쉽다.
- 하지만 나중에 코드를 유지보수할 사람이 코드를 짠 사람만큼 코드를 이해할 가능성은 희박하다.
- 그러므로 코드는 개발자의 의도를 분명히 표현해야 한다.
    
    1) 좋은 이름을 선택한다.
    
    2) 함수와 클래스 크기를 가능한 줄인다.
    
    3) 표준 명칭을 사용한다.
    
    4) 단위 테스트 케이스를 꼼꼼히 작성한다.
    

<br />

# 6. 클래스와 메서드 수를 최소로 줄여라.

- 중복을 제거하고, 의도를 표현하고, SRP를 준수한다는 규칙을 극단으로 지키게 되면 득보다 실이 많아질 수도 있다.
- 클래스와 메서드 크기를 줄이고자 클래스와 메서드를 수없이 만들게 될 수도 있다.
- 목표는 함수와 클래스 크기를 작게 유지하면서 동시에 시스템 크기도 작게 유지하는 데 있다.
- 다만, 앞의 규칙들보다 우선순위는 가장 낮다.

<br />

# 7. 결론

- 경험을 대신할 개발 기법은 없으나 위의 기법들은 수십 년 동안 쌓은 경험에 의거한 내용들이므로 해당 규칙들을 준수한다면 우수한 기법과 원칙을 활용할 수 있게 될 것이다.